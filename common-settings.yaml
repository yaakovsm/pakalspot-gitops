# Common Settings - All Default Configuration Values
# This file contains all common/default configurations that are shared across environments
# The chart's values.yaml is minimal (structure only) - all actual values are here

# Global configuration
global:
  imagePullSecrets:
    - name: ghcr-pull

# Application metadata (same across all environments)
app:
  name: pakalspot

# Frontend configuration - common defaults
frontend:
  enabled: true
  image:
    repository: yaakovsm/pakalspot-frontend
  service:
    type: ClusterIP
    port: 80
    targetPort: 80
  resources:
    limits:
      cpu: 200m
      memory: 256Mi
    requests:
      cpu: 100m
      memory: 128Mi
  livenessProbe:
    httpGet:
      path: /
      port: 80
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3
  readinessProbe:
    httpGet:
      path: /
      port: 80
    initialDelaySeconds: 5
    periodSeconds: 5
    timeoutSeconds: 3
    failureThreshold: 3
  startupProbe:
    httpGet:
      path: /
      port: 80
    initialDelaySeconds: 10
    periodSeconds: 5
    timeoutSeconds: 3
    failureThreshold: 30
  env:
    VITE_HOST: "0.0.0.0"
    VITE_API_URL: "/api"
  envRuntime:
    VITE_GOOGLE_MAPS_API_KEY: ""

# Backend configuration - common defaults
backend:
  enabled: true
  image:
    repository: yaakovsm/pakalspot-backend
  service:
    type: ClusterIP
    port: 80
    targetPort: 8000
  resources:
    limits:
      cpu: 500m
      memory: 512Mi
    requests:
      cpu: 250m
      memory: 256Mi
  livenessProbe:
    httpGet:
      path: /docs
      port: 8000
    initialDelaySeconds: 60
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3
  readinessProbe:
    httpGet:
      path: /docs
      port: 8000
    initialDelaySeconds: 30
    periodSeconds: 5
    timeoutSeconds: 3
    failureThreshold: 3
  startupProbe:
    httpGet:
      path: /docs
      port: 8000
    initialDelaySeconds: 10
    periodSeconds: 5
    timeoutSeconds: 3
    failureThreshold: 30
  env:
    JWT_EXPIRY: "43200"
    API_PREFIX: "/api"
  initContainers:
    dbMigrate:
      enabled: true
      command: ["alembic", "upgrade", "head"]
    dbSeed:
      enabled: true
      command: ["python", "/app/app/db/seed.py"]

# Database configuration - common defaults
database:
  enabled: true
  type: postgresql
  statefulSet:
    enabled: true
  image:
    repository: postgis/postgis
    tag: "15-3.3"
    pullPolicy: IfNotPresent
  service:
    type: ClusterIP
    port: 5432
    targetPort: 5432
  resources:
    limits:
      cpu: 500m
      memory: 1Gi
    requests:
      cpu: 250m
      memory: 512Mi
  livenessProbe:
    exec:
      command:
        - /bin/sh
        - -c
        - exec pg_isready -U "$POSTGRES_USER" -d "$POSTGRES_DB" -h 127.0.0.1 -p 5432
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3
  readinessProbe:
    exec:
      command:
        - /bin/sh
        - -c
        - exec pg_isready -U "$POSTGRES_USER" -d "$POSTGRES_DB" -h 127.0.0.1 -p 5432
    initialDelaySeconds: 5
    periodSeconds: 5
    timeoutSeconds: 3
    failureThreshold: 3
  persistence:
    enabled: true
    size: 10Gi
    accessMode: ReadWriteOnce
  config:
    POSTGRES_DB: "pakalspot_db"
    POSTGRES_PORT: "5432"
  securityContext:
    runAsUser: 999
    runAsGroup: 999
    fsGroup: 999

# Secrets configuration - common defaults
secrets:
  database:
    POSTGRES_USER: "pakalspot_user"

# Ingress configuration - common defaults
ingress:
  enabled: true
  className: "traefik"
  annotations:
    traefik.ingress.kubernetes.io/router.entrypoints: web

# Service Account - common defaults
serviceAccount:
  create: true
  automount: true

# Pod Security Context - common defaults
podSecurityContext:
  runAsNonRoot: true
  runAsUser: 1000
  runAsGroup: 1000
  fsGroup: 1000

# Container Security Context - common defaults
securityContext:
  allowPrivilegeEscalation: false
  readOnlyRootFilesystem: false
  runAsNonRoot: true
  runAsUser: 1000
  capabilities:
    drop:
      - ALL

# Autoscaling - common defaults (disabled by default)
autoscaling:
  enabled: false
  frontend:
    enabled: false
    minReplicas: 1
    maxReplicas: 5
    targetCPUUtilizationPercentage: 80
    targetMemoryUtilizationPercentage: 80
    behavior:
      scaleDown:
        stabilizationWindowSeconds: 300
        policies:
          - type: Percent
            value: 50
            periodSeconds: 60
      scaleUp:
        stabilizationWindowSeconds: 0
        policies:
          - type: Percent
            value: 100
            periodSeconds: 60
          - type: Pods
            value: 2
            periodSeconds: 60
        selectPolicy: Max
  backend:
    enabled: false
    minReplicas: 1
    maxReplicas: 10
    targetCPUUtilizationPercentage: 75
    targetMemoryUtilizationPercentage: 80
    behavior:
      scaleDown:
        stabilizationWindowSeconds: 300
        policies:
          - type: Percent
            value: 50
            periodSeconds: 60
      scaleUp:
        stabilizationWindowSeconds: 0
        policies:
          - type: Percent
            value: 100
            periodSeconds: 60
          - type: Pods
            value: 2
            periodSeconds: 60
        selectPolicy: Max

# Pod Disruption Budget - common defaults
podDisruptionBudget:
  enabled: false
  frontend:
    enabled: false
    minAvailable: 1
  backend:
    enabled: false
    minAvailable: 1

# Network Policy - common defaults
networkPolicy:
  enabled: false
  policyTypes:
    - Ingress
    - Egress
  ingress:
    - from:
        - namespaceSelector:
            matchLabels:
              name: ingress-nginx
        - podSelector: {}
      ports:
        - protocol: TCP
          port: 80
  egress:
    - to:
        - podSelector:
            matchLabels:
              app.kubernetes.io/component: database
      ports:
        - protocol: TCP
          port: 5432
    - to:
        - namespaceSelector: {}
      ports:
        - protocol: TCP
          port: 443
        - protocol: TCP
          port: 53
        - protocol: UDP
          port: 53

# Monitoring - common defaults
monitoring:
  enabled: false
  prometheus:
    enabled: false
  grafana:
    enabled: false

# Resource Quotas - common defaults
resourceQuota:
  enabled: false
  hard: {}
